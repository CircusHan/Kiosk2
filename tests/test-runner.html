<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Unit Tests</title>
    <link rel="stylesheet" href="../css/style.css"> <!-- Optional: for styling test results -->
    <style>
        body { padding: 20px; }
        .test-suite { margin-bottom: 20px; border: 1px solid #ccc; padding: 10px; }
        .test-suite h3 { margin-top: 0; }
        .test-result { margin: 5px 0; padding: 5px; border-left: 3px solid; }
        .test-result.pass { border-left-color: green; background-color: #e6ffe6;}
        .test-result.fail { border-left-color: red; background-color: #ffe6e6;}
        .summary { font-weight: bold; }
    </style>
</head>
<body>
    <h1>Application Unit Tests</h1>
    <div id="testResults"></div>

    <!-- Load application scripts first, as tests depend on them -->
    <!-- Mocks for Web APIs will be defined in the test scripts themselves -->
    <script src="../js/settings.js"></script>
    <script src="../js/app.js"></script>

    <!-- Load test scripts -->
    <script src="settings.test.js"></script>
    <script src="app.test.js"></script>

    <script>
        // Simple Test Runner
        const resultsContainer = document.getElementById('testResults');
        let totalTests = 0;
        let passedTests = 0;
        let currentSuiteId = ''; // Keep track of the current suite for adding tests

        function describe(suiteName, fn) {
            resultsContainer.innerHTML += `<div class="test-suite"><h3>${suiteName}</h3><div id="${suiteName.replace(/\s+/g, '-')}"></div></div>`;
            currentSuiteId = suiteName.replace(/\s+/g, '-');
            fn();
        }

        function it(testName, fn) {
            totalTests++;
            const suiteDiv = document.getElementById(currentSuiteId);
            let result = 'fail';
            let errorMessage = '';
            try {
                fn(); // Execute the test function
                result = 'pass';
                passedTests++;
            } catch (e) {
                errorMessage = e.stack || e.message;
            }
            const resultClass = result === 'pass' ? 'pass' : 'fail';
            // Ensure suiteDiv exists before trying to add to it
            if (suiteDiv) {
                suiteDiv.innerHTML += `<div class="test-result ${resultClass}"><strong>${testName}:</strong> ${result.toUpperCase()}<pre>${errorMessage}</pre></div>`;
            } else {
                console.error('Could not find suiteDiv for ID:', currentSuiteId);
                // Fallback: append to main results container if suite div is missing
                resultsContainer.innerHTML += `<div class="test-result ${resultClass}"><strong>${currentSuiteId} / ${testName}:</strong> ${result.toUpperCase()}<pre>${errorMessage}</pre></div>`;
            }
        }

        // Add a summary at the end
        window.addEventListener('load', () => {
             resultsContainer.innerHTML += `<div class="summary">Ran ${totalTests} tests. Passed: ${passedTests}, Failed: ${totalTests - passedTests}</div>`;
             if (totalTests - passedTests > 0) {
                 console.error(`TESTS FAILED: ${totalTests - passedTests} out of ${totalTests}`);
             } else if (totalTests > 0) { // Only log all passed if there were tests
                 console.log(`ALL TESTS PASSED: ${passedTests} out of ${totalTests}`);
             } else {
                 console.log("No tests were run.");
             }
        });
    </script>
</body>
</html>
